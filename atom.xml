<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://turboyu.github.io</id>
    <title>村头的水泥地</title>
    <updated>2019-05-27T17:57:44.685Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://turboyu.github.io"/>
    <link rel="self" href="https://turboyu.github.io/atom.xml"/>
    <subtitle>自由的灵魂不需要讨喜</subtitle>
    <logo>https://turboyu.github.io/images/avatar.png</logo>
    <icon>https://turboyu.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, 村头的水泥地</rights>
    <entry>
        <title type="html"><![CDATA[科学上网的正确姿势：在 Vultr VPS 上搭建 Shadowsocks]]></title>
        <id>https://turboyu.github.io/post/ke-xue-shang-wang-de-zheng-que-zi-shi-zai-vultr-vps-shang-da-jian-shadowsocks</id>
        <link href="https://turboyu.github.io/post/ke-xue-shang-wang-de-zheng-que-zi-shi-zai-vultr-vps-shang-da-jian-shadowsocks">
        </link>
        <updated>2019-05-27T09:46:31.000Z</updated>
        <content type="html"><![CDATA[<p>而且这些服务通常价格不低，稳定性也差强人意。这时候可以想想，反正都是通过海外服务器来提供建服务，为什么不干脆自己来搭呢？既能独享带宽，又安心可控，而且选取合适的供应商的话，价格也很平易近人。</p>
<p>所以，如果你不满足那些服务，又有耐心的话，这里有一份详细而对萌新友好的入坑指南。事先说明，如果你希望不花一分钱就能用上优质的服务......醒醒！别做梦了！免费和优质从来不可能划上等号。</p>
<h2 id="1-一些背景和原理">1. 一些背景和原理</h2>
<p>因为整个折腾过程对没有技术背景的人来说，还是略显复杂的，所以有必要先粗浅地介绍一下所涉及的概念和原理。如果不感兴趣可以跳过第一部分，直接看操作步骤。</p>
<h3 id="11-什么是-shadowsocks">1.1 什么是 Shadowsocks</h3>
<p><img src="https://turboyu.github.io/post-images/1558971056501.png" alt=""></p>
<p>Shadowsocks(ss) 是由 Clowwindy 开发的一款软件，其作用本来是加密传输资料。当然，也正因为它加密传输资料的特性，使得 GFW 没法将由它传输的资料和其他普通资料区分开来（上图），也就不能干扰我们访问那些「不存在」的网站了。</p>
<p>但是时至今日，Shadowsocks 的安全性被发现是存在缺陷的，其 IP 和端口可以被嗅探到。因而，有了基于它但增加了混淆能力的 ShadowsocksR 项目、Simple-obfs 插件，以及 v2ray 项目等。</p>
<p>它们本质上，都是依托墙外服务器的网络代理软件。ssR 和官方版 ss 均已不再更新，目前还在更新的只有 shadowsocks-libev，可以说是最轻量的 ss 版本，也是本文推荐安装使用的版本。</p>
<h3 id="12-什么是-vps-和-vultr">1.2 什么是 VPS 和 Vultr</h3>
<p>VPS (Virtual private server) 译作虚拟专用伺服器。你可以把它简单地理解为一台在远端的强劲电脑。当你租用了它以后，可以给它安装操作系统、软件，并通过一些工具连接和远程操控它。</p>
<p>Vultr 则是一家 VPS 服务器供应商，有美国、亚洲、欧洲等多地的 VPS。它家的服务器以性价比高闻名，按时间计费，最低的资费为每月 $2.5。</p>
<p><img src="https://turboyu.github.io/post-images/1558971562481.png" alt=""></p>
<p>比 Vultr 价格更低的服务商也有许多，最知名的莫过于「<a href="https://bandwagonhost.com/">搬瓦工</a>」，和 V 家差不多的配置只要 $19.9 每年。不过后者过于出名，据说超售严重，实测夜间速度足以让人痛哭流涕。</p>
<h3 id="13-什么是-linux-和-ssh">1.3 什么是 Linux 和 SSH</h3>
<p>Linux 是免费开源的操作系统，大概被世界上过半服务器所采用。有大量优秀的开源软件可以安装，上述 Shadowsocks 就是其一。你可以通过命令行来直接给 Linux 操作系统「下命令」，比如 <code>$ cd Desktop</code> 就是进入你根目录下的 <code>Desktop</code> 文件夹。</p>
<p><img src="https://turboyu.github.io/post-images/1558972194100.jpg" alt=""></p>
<p>而 SSH 是一种网络协议，作为每一台 Linux 电脑的标准配置，用于计算机之间的加密登录。当你为租用的 VPS 安装 Linux 系统后，只要借助一些工具，就可以用 SSH 在你自己的 Mac/PC 电脑上远程登录该 VPS 了。</p>
<h2 id="2-购买和连接-vps">2. 购买和连接 VPS</h2>
<p>首先，访问 <a href="https://www.vultr.com/?ref=7270768">Vultr.com</a> 注册帐号，网站目前还没有被墙，访问速度不错。</p>
<h3 id="21-注册-vultr">2.1 注册 Vultr</h3>
<p>Vultr 官网定期会有一些促销活动，可以留意。另外，如果使用我的 <a href="https://www.vultr.com/?ref=7270768">推荐链接</a> 注册，激活后可以获赠 $50 试用金！！！有效期两个月。</p>
<p><img src="https://turboyu.github.io/post-images/1558973403007.jpg" alt=""></p>
<p>换句话说，注册后两个月内可以免费使用 5 个最低配置的 VPS。可以趁这段时间，把不同国家的节点试个遍，不过到期后记着删除多余的服务器。</p>
<h3 id="22-部署-vps">2.2 部署 VPS</h3>
<p>注册完成后，在左边选择“Servers”标签，点击右边的加号部署新的服务器。</p>
<p><img src="https://turboyu.github.io/post-images/1558974114555.jpg" alt=""></p>
<p>选择一个你想要的节点。推荐东京和洛杉矶，速度较快，不过这也受运营商网络、你的地理位置影响，如果有试用金可以多建几个自行对比。</p>
<p><img src="https://turboyu.github.io/post-images/1558975236636.jpg" alt=""></p>
<p>为 VPS 选择安装系统。这里因为安装脚本限制的原因，请选择 CentOS 6+，Debian 7+，Ubuntu 12+ 的系统，具体哪个可以随自己喜欢。下面的教程以 Ubuntu 18.10 为例。</p>
<p><img src="https://turboyu.github.io/post-images/1558975284176.jpg" alt=""></p>
<p>根据需求选择套餐。只需科学上网的话，$5 绰绰有余。</p>
<p><img src="https://turboyu.github.io/post-images/1558975476777.jpg" alt=""></p>
<p>部分节点（Atlanta、New York）会有限时 $2.5 的套餐。</p>
<p><img src="https://turboyu.github.io/post-images/1558975425883.jpg" alt=""></p>
<p>剩下都可以使用默认值。最后一项你可以自定义服务器的名字和标签，以方便区分。</p>
<p>另外，上图第 6 步中，SSH Keys 的作用是，可以让你登录 VPS 时不用每次手动输密码。若只将其用作 Shadowsocks 服务器，仅需要在配置时登录一次，可以完全忽略它。如果要同时作他用，可参考 <a href="https://www.vultr.com/docs/how-do-i-generate-ssh-keys/">此文</a> 生成并添加 SSH Key。</p>
<p><img src="https://turboyu.github.io/post-images/1558975063656.jpg" alt=""></p>
<p>等待系统安装完成。当显示“Running”时，就表示部署已完成。之后你可以随时停用、重启或销毁它。</p>
<p><img src="https://turboyu.github.io/post-images/1558975976419.jpg" alt=""></p>
<h3 id="23-连接-vps">2.3 连接 VPS</h3>
<p>如果你使用的是 PC，连接 VPS 需要借助一些工具，比如 <a href="https://www.putty.org/">Putty</a>。你可以参考这篇 <a href="https://jingyan.baidu.com/article/8ebacdf0d9e86549f75cd57b.html">百度经验</a> 完成安装，安装完成后步骤与下文 Mac 一致。</p>
<p>Mac 只要打开「终端」应用即可开始使用 SSH 连接 VPS。你的「终端」界面可能和下图略有差别，但是差不远 ── 都有一个闪烁的光标，前面会有一个 <code>$</code> 符号。</p>
<p><img src="https://turboyu.github.io/post-images/1558976344850.jpg" alt=""></p>
<p>首先，在 Vultr 上你刚部署的服务器右边点&quot;Manage&quot;，找到服务器的 IP 地址（标黄部分）和密码。</p>
<p><img src="https://turboyu.github.io/post-images/1558976877969.jpg" alt=""></p>
<p>在「终端」或 Putty 等应用中，输入下面的命令并回车。注意把 <code>&lt;host&gt;</code> 替换成你服务器的 IP 地址。</p>
<pre><code>ssh root@&lt;host&gt;
</code></pre>
<p>接下来屏幕上会出现一连串提示，意为无法确认 host 主机的真实性，只知道它的公钥指纹，问你还想继续连接吗？直接输入 yes 并回车。</p>
<p><img src="https://turboyu.github.io/post-images/1558977168972.jpg" alt=""></p>
<p>然后输入密码，也就是把服务器状态页中密码那块复制一下或者点旁边图标直接复制到剪贴板上，再 <code>⌘ + v</code> 粘贴过来。这里不管是输入还是粘贴，屏幕上都不会显示字符，所以贴完后也是看不到字符的，回车就行。</p>
<p><img src="https://turboyu.github.io/post-images/1558977288253.jpg" alt=""></p>
<p>当出现上图那串 <code>[root@vultr ~]#</code> 时，说明已成功登录，以后再登录 ssh 时就不会出现公钥指纹提示了。</p>
<p><img src="https://turboyu.github.io/post-images/1558977496598.jpg" alt=""></p>
<h2 id="3-部署-shadowsocks">3. 部署 Shadowsocks</h2>
<p>Shadowsocks 需要同时具备客户端和服务器端，所以它的安装也需要分两步。</p>
<h3 id="31-部署-shadowsocks-服务器端">3.1 部署 Shadowsocks 服务器端</h3>
<p>这里使用一个一键安装脚本，几乎不需要多余的操作，只需根据提示做选择即可。</p>
<p>首先输入以下 3 行命令，每次输入一行、回车，等待屏幕上的操作完成后再输入下一条。</p>
<pre><code>wget --no-check-certificate -O shadowsocks-all.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh

chmod +x shadowsocks-all.sh

./shadowsocks-all.sh 2&gt;&amp;1 | tee shadowsocks-all.log
</code></pre>
<p>最后一步输完，你应该会看到下图中内容──是要你选择需要安装的 Shadowsocks 版本。这里选择
4)<a href="https://github.com/shadowsocks/shadowsocks-libev">shadowsocks-libev</a>，因为正如上文所说，这是目前唯一在持续更新且最为轻量的版本。</p>
<p><img src="https://turboyu.github.io/post-images/1558977862089.png" alt=""></p>
<p>选好输入回车后，会让你输入 Shadowsocks 的密码。</p>
<p><img src="https://turboyu.github.io/post-images/1558977855710.png" alt=""></p>
<p>然后选择一个端口，输入 1-65535 间的任意数字都行。</p>
<p><img src="https://turboyu.github.io/post-images/1558977933236.png" alt=""></p>
<p>之后可以选择加密方式，默认是 aes-256-gcm。如果没有特殊偏好，保持默认即可。</p>
<p><img src="https://turboyu.github.io/post-images/1558977955784.png" alt=""></p>
<p>之后会提示你是否需要安装 <a href="https://github.com/shadowsocks/simple-obfs">simple-obfs</a>。这是 ss 的一个插件工具，可以起到混淆的作用，防止 IP 和端口被嗅探到，建议选 <code>y</code> 安装。</p>
<p><img src="https://turboyu.github.io/post-images/1558978017944.png" alt=""></p>
<p>如果上一步选择了 <code>y</code>，这里可以选择一种混淆方式。通常 <code>tls</code> 要比 <code>http</code> 的混淆效果更好，所以选 <code>tls</code>。</p>
<p><img src="https://turboyu.github.io/post-images/1558978079869.png" alt=""></p>
<p>之后所有的配置就完成了，按任意键开始部署 Shadowsocks-libev。这时你什么都不用做，只需要耐心地等它运行完就好。</p>
<p><img src="https://turboyu.github.io/post-images/1558978113286.png" alt=""></p>
<p>结束后就会看到你所部署的 Shadowsocks 的配置信息。</p>
<p><img src="https://turboyu.github.io/post-images/1558978139553.png" alt=""></p>
<p>记住红色的内容，也就是服务器 IP、服务器 ss 端口、你设的密码、混淆方式和加密方式。</p>
<h3 id="32-检查和配置-shadowsocks">3.2 检查和配置 Shadowsocks</h3>
<p>安装完成以后，Shadowsocks 的服务器端就已经配置完了，你可以输入以下命令检查是否已经开始运行。</p>
<pre><code>/etc/init.d/shadowsocks-libev status
</code></pre>
<p>如果出现类似 <code>Shadowsocks-libev is running...</code> 的字样，说明已经开始正常运行了。</p>
<p>这时你已经可以在自己的任意设备上进行登录使用了。如果你要修改 ss 的配置，或者忘了当初自己设置的密码和端口，可以用以下命令来打开配置文件。</p>
<p><code>nano /etc/shadowsocks-libev/config.json</code></p>
<p>意为用 <code>nano</code> 这个编辑器打开 <code>config.json</code> 这个配置文件。你的「终端」会刷新一下，出现下图。</p>
<p><img src="https://turboyu.github.io/post-images/1558978759929.png" alt=""></p>
<p>如果某天你的 ss 突然无法使用了，很可能就是端口被封了。这时你可以直接在这里，将端口修改为 1-65535 间任意其他数字。编辑完成后，按 <code>Ctrl + X</code> ，再输入 <code>Y</code> 并回车确认退出。</p>
<p>需注意的是，如果你更新了配置文件，得重启 ss 才能生效。重启命令如下：</p>
<p><code>/etc/init.d/shadowsocks-libev restart</code></p>
<p>另外，如需添加多端口或多用户 —— 很遗憾，shadowsocks-libev 无法通过简单的修改配置文件来实现。不过，作者另外开发了一个 ss-manager，来管理和开启多端口，感兴趣的话我以后会再更新一篇教程。</p>
<h3 id="33-安装-shadowsocks-客户端">3.3 安装 Shadowsocks 客户端</h3>
<p>恭喜你！如果你坚持到了现在，那么万里长征你已经走完了90%！坚持下去✊</p>
<p>相比服务器端的安装，客户端的安装就简单了许多。首先，在 <a href="https://shadowsocks.org/en/download/clients.html">这个页面</a> 找到并下载自己操作系统对应的客户端。</p>
<p><img src="https://turboyu.github.io/post-images/1558979619969.jpg" alt=""></p>
<p>打开客户端，在「服务器设定」里新增服务器。</p>
<p><img src="https://turboyu.github.io/post-images/1558979667182.jpg" alt=""></p>
<p>然后依次填入服务器 IP、服务器端口、你设的密码和加密方式。</p>
<p><img src="https://turboyu.github.io/post-images/1558979659410.jpg" alt=""></p>
<p>此处如果之前有安装 simple-obfs，需在插件一栏填写 <code>obfs-local</code>，插件选项填写 <code>obfs=tls</code> 或 <code>obfs=http</code>（视乎你选择的混淆方式）。</p>
<p>然后启用代理，就可以实现科学上网了。</p>
]]></content>
    </entry>
</feed>